{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/server/cli/index.ts","webpack:///./src/server/cli/parseArgs.ts","webpack:///./src/server/command/address.ts","webpack:///./src/server/command/index.ts","webpack:///./src/server/command/login.ts","webpack:///./src/server/command/parse.ts","webpack:///./src/server/command/ssh.ts","webpack:///./src/server/index.ts","webpack:///./src/server/socketServer/html.ts","webpack:///./src/server/socketServer/index.ts","webpack:///./src/server/utils/index.ts","webpack:///./src/server/utils/logger.ts","webpack:///./src/server/utils/ssl.ts","webpack:///./src/server/wetty/index.ts","webpack:///./src/server/wetty/term/index.ts","webpack:///./src/server/wetty/term/login.ts","webpack:///./src/server/wetty/term/spawn.ts","webpack:///./src/server/wetty/term/xterm.ts","webpack:///external \"compression\"","webpack:///external \"crypto\"","webpack:///external \"express\"","webpack:///external \"express-winston\"","webpack:///external \"fs\"","webpack:///external \"fs-extra\"","webpack:///external \"helmet\"","webpack:///external \"http\"","webpack:///external \"https\"","webpack:///external \"lodash/isUndefined\"","webpack:///external \"node-pty\"","webpack:///external \"os\"","webpack:///external \"path\"","webpack:///external \"serve-favicon\"","webpack:///external \"socket.io\"","webpack:///external \"url\"","webpack:///external \"winston\"","webpack:///external \"yargs\""],"names":["init","opts","help","ssh","server","command","forcessh","ssl","unWrapArgs","WeTTy","catch","err","logger","error","process","exitCode","yargs","args","user","sshuser","host","sshhost","auth","sshauth","port","sshport","pass","sshpass","key","sshkey","knownhosts","base","title","bypasshelmet","sslkey","sslcert","undefined","cert","address","referer","match","fallback","split","localhost","getuid","urlArgs","def","Object","assign","url","query","request","headers","client","conn","remoteAddress","loginOptions","sshOptions","includes","getRemoteAddress","parseCommand","path","cmd","hostChecking","sshRemoteOptsBase","info","concat","splice","indexOf","start","req","res","resourcePath","test","replace","send","distDir","__dirname","trim","str","createServer","basePath","app","express","use","expressWinston","compression","favicon","next","substr","length","redirect","slice","helmet","html","get","socket","https","listen","connection","http","pingInterval","pingTimeout","combine","timestamp","label","simple","json","colorize","format","createLogger","all","transports","Console","level","handleExceptions","loadSSL","Promise","readFile","resolve","startWeTTy","serverConf","then","sslBuffer","warn","io","on","sshUser","getCommand","debug","join","spawn","login","username","fs","require","os","crypto","remoteUser","termPath","fileData","readFileSync","tmpdir","randomFillSync","Buffer","alloc","toString","writeFileSync","term","xterm","buf","reject","data","emit","input","write","exec","kill","spawnTerm","pid","code","removeAllListeners","cols","rows","resize","name","cwd","env","keys","filter","map"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/server/index.ts\");\n","import * as yargs from 'yargs';\nimport { logger } from '../utils';\nimport WeTTy from '../wetty';\nimport { CLI } from './options';\nimport { unWrapArgs } from './parseArgs';\n\nexport default function init(opts: CLI): void {\n  if (!opts.help) {\n    const { ssh, server, command, forcessh, ssl } = unWrapArgs(opts);\n    WeTTy(ssh, server, command, forcessh, ssl).catch(err => {\n      logger.error(err);\n      process.exitCode = 1;\n    });\n  } else {\n    yargs.showHelp();\n    process.exitCode = 0;\n  }\n}\n","import { isUndefined } from 'lodash';\nimport { SSH, SSL, Server } from '../interfaces';\nimport { Options } from './options';\n\nexport function unWrapArgs(\n  args: Options\n): { ssh: SSH; server: Server; command?: string; forcessh?: boolean; ssl?: SSL } {\n  return {\n    ssh: {\n      user: args.sshuser,\n      host: args.sshhost,\n      auth: args.sshauth,\n      port: args.sshport,\n      pass: args.sshpass,\n      key: args.sshkey,\n      knownhosts: args.knownhosts,\n    },\n    server: {\n      base: args.base,\n      host: args.host,\n      port: args.port,\n      title: args.title,\n      bypasshelmet: args.bypasshelmet || false,\n    },\n    command: args.command,\n    forcessh: args.forcessh,\n    ssl:\n      isUndefined(args.sslkey) || isUndefined(args.sslcert)\n        ? undefined\n        : { key: args.sslkey, cert: args.sslcert },\n  };\n}\n","export default function address(\n  referer: string,\n  user: string,\n  host: string\n): string {\n  const match = referer.match('.+/ssh/([^/]+)$');\n  const fallback = user ? `${user}@${host}` : host;\n  return match ? `${match[1].split('?')[0]}@${host}` : fallback;\n}\n","import * as url from 'url';\nimport { Socket } from 'socket.io';\nimport { SSH } from '../interfaces';\nimport address from './address';\nimport loginOptions from './login';\nimport sshOptions from './ssh';\n\nconst localhost = (host: string): boolean =>\n  process.getuid() === 0 &&\n  (host === 'localhost' || host === '0.0.0.0' || host === '127.0.0.1');\n\nconst urlArgs = (\n  referer: string,\n  def: { [s: string]: string | undefined }\n): { [s: string]: string } =>\n  Object.assign(def, url.parse(referer, true).query);\n\nexport default (\n  {\n    request: {\n      headers: { referer },\n    },\n    client: {\n      conn: { remoteAddress },\n    },\n  }: Socket,\n  { user, host, port, auth, pass, key, knownhosts }: SSH,\n  command: string,\n  forcessh: boolean\n): { args: string[]; user: boolean } => ({\n  args: !forcessh && localhost(host)\n    ? loginOptions(command, remoteAddress)\n    : sshOptions(\n        { ...urlArgs(referer, {\n            port: `${port}`,\n            pass: pass || '',\n            command,\n            auth,\n            knownhosts,\n          }),\n          host: address(referer, user, host)\n        },\n        key\n      ),\n  user:\n    (!forcessh && localhost(host)) ||\n    user !== '' ||\n    user.includes('@') ||\n    address(referer, user, host).includes('@'),\n});\n","import { isUndefined } from 'lodash';\n\nconst getRemoteAddress = (remoteAddress: string): string =>\n  isUndefined(remoteAddress.split(':')[3])\n    ? 'localhost'\n    : remoteAddress.split(':')[3];\n\nexport default function loginOptions(\n  command: string,\n  remoteAddress: string\n): string[] {\n  return command === 'login'\n    ? [command, '-h', getRemoteAddress(remoteAddress)]\n    : [command];\n}\n","import { isUndefined } from 'lodash';\n\nexport default function parseCommand(command: string, path?: string): string {\n  if (command === 'login' && isUndefined(path)) return '';\n  return !isUndefined(path)\n    ? `$SHELL -c \"cd ${path};${command === 'login' ? '$SHELL' : command}\"`\n    : command;\n}\n","import { isUndefined } from 'lodash';\nimport parseCommand from './parse';\nimport logger from '../utils/logger';\n\nexport default function sshOptions(\n  { pass, path, command, host, port, auth, knownhosts }: { [s: string]: string },\n  key?: string\n): string[] {\n  const cmd = parseCommand(command, path);\n  const hostChecking = (knownhosts !== '/dev/null') ? 'yes' : 'no'\n  const sshRemoteOptsBase = [\n    'ssh',\n    host,\n    '-t',\n    '-p',\n    port,\n    '-o',\n    `PreferredAuthentications=${auth}`,\n    '-o',\n    `UserKnownHostsFile=${knownhosts}`,\n    '-o', \n    `StrictHostKeyChecking=${hostChecking}`,\n  ];\n  logger.info(`Authentication Type: ${auth}`);\n  if (!isUndefined(key)) {\n    return sshRemoteOptsBase.concat(['-i', key, cmd]);\n  }\n  if (pass !== '') {\n    return ['sshpass', '-p', pass].concat(sshRemoteOptsBase, [cmd]);\n  }\n  if (auth === 'none') {\n    sshRemoteOptsBase.splice(sshRemoteOptsBase.indexOf('-o'), 2);\n  }\n\n  if (cmd === '') {\n    return sshRemoteOptsBase;\n  }\n  return sshRemoteOptsBase.concat([cmd]);\n}\n","import WeTTy from './wetty';\nimport init from './cli';\n\nexport default { start: WeTTy, init };\n","import * as express from 'express';\n\nexport default (base: string, title: string) => (\n  req: express.Request,\n  res: express.Response\n): void => {\n  const resourcePath = /^\\/ssh\\//.test(req.url.replace(base, '/'))\n    ? '../'\n    : base;\n\n  res.send(`<!doctype html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=no\">\n    <title>${title}</title>\n    <link rel=\"stylesheet\" href=\"${resourcePath}public/index.css\" />\n  </head>\n  <body>\n    <div id=\"overlay\">\n      <div class=\"error\">\n        <div id=\"msg\"></div>\n        <input type=\"button\" onclick=\"location.reload();\" value=\"reconnect\" />\n      </div>\n    </div>\n    <div id=\"options\">\n      <a class=\"toggler\"\n         href=\"#\"\n         alt=\"Toggle options\"><i class=\"fas fa-cogs\"></i></a>\n      <textarea class=\"editor\"></textarea>\n    </div>\n    <div id=\"terminal\"></div>\n    <script src=\"${resourcePath}public/index.js\"></script>\n  </body>\n</html>`);\n};\n","import { isUndefined } from 'lodash';\nimport * as compression from 'compression';\nimport * as express from 'express';\nimport * as favicon from 'serve-favicon';\nimport * as helmet from 'helmet';\nimport * as http from 'http';\nimport * as https from 'https';\nimport * as path from 'path';\nimport * as socket from 'socket.io';\nimport * as expressWinston from 'express-winston';\nimport { SSLBuffer, Server } from '../interfaces';\nimport html from './html';\nimport logger from '../utils/logger';\n\nconst distDir = path.join(__dirname, 'client');\n\nconst trim = (str: string): string => str.replace(/\\/*$/, '');\n\nexport default function createServer(\n  { base, port, host, title, bypasshelmet }: Server,\n  { key, cert }: SSLBuffer\n): SocketIO.Server {\n  const basePath = trim(base);\n\n  logger.info('Starting server', {\n    key,\n    cert,\n    port,\n    base,\n    title,\n  });\n\n  const app = express();\n  app\n    .use(expressWinston.logger(logger))\n    .use(compression())\n    .use(favicon(path.join(distDir, 'favicon.ico')))\n    .use(`${basePath}/public`, express.static(distDir))\n    .use((req, res, next) => {\n      if (req.path.substr(-1) === '/' && req.path.length > 1)\n        res.redirect(\n          301,\n          req.path.slice(0, -1) + req.url.slice(req.path.length)\n        );\n      else next();\n    });\n\n  // Allow helmet to be bypassed.\n  // Unfortunately, order matters with middleware\n  // which is why this is thrown in the middle\n  if (!bypasshelmet) {\n    app.use(helmet());\n  }\n\n  const client = html(base, title);\n  app.get(basePath, client).get(`${basePath}/ssh/:user?`, client);\n\n  return socket(\n    !isUndefined(key) && !isUndefined(cert)\n      ? https.createServer({ key, cert }, app).listen(port, host, () => {\n          logger.info('Server started', {\n            port,\n            connection: 'https',\n          });\n        })\n      : http.createServer(app).listen(port, host, () => {\n          logger.info('Server started', {\n            port,\n            connection: 'http',\n          });\n        }),\n    {\n      path: `${basePath}/socket.io`,\n      pingInterval: 3000,\n      pingTimeout: 7000\n    }\n  );\n}\n","import logger from './logger';\n\nexport { logger };\n\nexport * from './ssl';\n","import { createLogger, format, transports } from 'winston';\n\nconst { combine, timestamp, label, simple, json, colorize } = format;\n\nconst logger = createLogger({\n  format: combine(\n    colorize({ all: process.env.NODE_ENV === 'development' }),\n    label({ label: 'Wetty' }),\n    timestamp(),\n    simple()\n  ),\n  transports: [\n    new transports.Console({\n      level: process.env.NODE_ENV === 'development' ? 'debug' : 'warn',\n      handleExceptions: true,\n    }),\n  ],\n});\n\nexport default logger;\n","import { readFile } from 'fs-extra';\nimport { resolve } from 'path';\nimport { isUndefined } from 'lodash';\nimport { SSL, SSLBuffer } from '../interfaces';\n\nexport async function loadSSL(ssl?: SSL): Promise<SSLBuffer> {\n  if (isUndefined(ssl) || isUndefined(ssl.key) || isUndefined(ssl.cert))\n    return {};\n  const [key, cert]: Buffer[] = await Promise.all([\n    readFile(resolve(ssl.key)),\n    readFile(resolve(ssl.cert)),\n  ]);\n  return { key, cert };\n}\n","/**\n * Create WeTTY server\n * @module WeTTy\n */\nimport server from '../socketServer';\nimport getCommand from '../command';\nimport { login, spawn } from './term';\nimport { loadSSL, logger } from '../utils';\nimport { SSH, SSL, SSLBuffer, Server } from '../interfaces';\n\n/**\n * Starts WeTTy Server\n * @name startWeTTy\n */\nexport default function startWeTTy(\n  ssh: SSH = { user: '', host: 'localhost', auth: 'password', port: 22 },\n  serverConf: Server = {\n    base: '/wetty/',\n    port: 3000,\n    host: '0.0.0.0',\n    title: 'WeTTy',\n    bypasshelmet: false,\n  },\n  command = '',\n  forcessh = false,\n  ssl?: SSL\n): Promise<SocketIO.Server> {\n  return loadSSL(ssl).then((sslBuffer: SSLBuffer) => {\n    if (ssh.key) {\n      logger.warn(`!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n! Password-less auth enabled using private key from ${ssh.key}.\n! This is dangerous, anything that reaches the wetty server\n! will be able to run remote operations without authentication.\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!`);\n    }\n\n    const io: SocketIO.Server = server(serverConf, sslBuffer);\n    /**\n     * Wetty server connected too\n     * @fires WeTTy#connnection\n     */\n    io.on('connection', (socket: SocketIO.Socket) => {\n      /**\n       * @event wetty#connection\n       * @name connection\n       */\n      logger.info('Connection accepted.');\n      const { args, user: sshUser } = getCommand(socket, ssh, command, forcessh);\n      logger.debug('Command Generated', {\n        user: sshUser,\n        cmd: args.join(' '),\n      });\n\n      if (sshUser) {\n        spawn(socket, args);\n      } else {\n        login(socket)\n          .then((username: string) => {\n            args[1] = `${username.trim()}@${args[1]}`;\n            logger.debug('Spawning term', {\n              username: username.trim(),\n              cmd: args.join(' ').trim(),\n            });\n            return spawn(socket, args);\n          })\n          .catch(() => {\n            logger.info('Disconnect signal sent');\n          });\n      }\n    });\n\n    return io;\n  });\n}\n","import spawn from './spawn';\n\nexport { spawn };\n\nexport * from './login';\n","import { spawn } from 'node-pty';\nimport { xterm } from './xterm';\nimport { join } from 'path';\nconst fs = require('fs');\nconst os = require('os');\nconst crypto = require('crypto');\n\nexport function login(socket: SocketIO.Socket): Promise<string> {\n  // Check request-header for username\n  const remoteUser = socket.request.headers['remote-user'];\n  if (remoteUser) {\n    return new Promise(resolve => {\n      resolve(remoteUser);\n    });\n  }\n\n  let termPath = join(__dirname, 'buffer.js');\n\n  if (termPath.match(/^\\/snapshot\\//)) {\n    // Handle case for binary build with pkg: copy terminal.js from inside binary package to\n    // temporary directory and use it from there.\n    const fileData = fs.readFileSync(termPath);\n    termPath = join(os.tmpdir(), `${crypto.randomFillSync(Buffer.alloc(10)).toString('hex')}.js`);\n    fs.writeFileSync(termPath, fileData);\n  }\n\n  // Request carries no username information\n  // Create terminal and ask user for username\n  const term = spawn('/usr/bin/env', ['node', termPath], xterm);\n  let buf = '';\n  return new Promise((resolve, reject) => {\n    term.on('exit', () => {\n      resolve(buf);\n    });\n    term.on('data', data => {\n      socket.emit('data', data);\n    });\n    socket\n      .on('input', (input: string) => {\n        term.write(input);\n        buf = /\\177/.exec(input) ? buf.slice(0, -1) : buf + input;\n      })\n      .on('disconnect', () => {\n        term.kill();\n        reject();\n      });\n  });\n}\n","import { isUndefined } from 'lodash';\nimport { spawn } from 'node-pty';\nimport { logger } from '../../utils';\nimport { xterm } from './xterm';\n\nexport default function spawnTerm(\n  socket: SocketIO.Socket,\n  args: string[]\n): void {\n  const term = spawn('/usr/bin/env', args, xterm);\n  const { pid } = term;\n  const address = args[0] === 'ssh' ? args[1] : 'localhost';\n  logger.info('Process Started on behalf of user', {\n    pid,\n    address,\n  });\n  socket.emit('login');\n  term.on('exit', code => {\n    logger.info('Process exited', { code, pid });\n    socket.emit('logout');\n    socket\n      .removeAllListeners('disconnect')\n      .removeAllListeners('resize')\n      .removeAllListeners('input');\n  });\n  term.on('data', data => {\n    socket.emit('data', data);\n  });\n  socket\n    .on('resize', ({ cols, rows }) => {\n      term.resize(cols, rows);\n    })\n    .on('input', input => {\n      if (!isUndefined(term)) term.write(input);\n    })\n    .on('disconnect', () => {\n      term.kill();\n      logger.info('Process exited', { code: 0, pid });\n    });\n}\n","import { IPtyForkOptions } from 'node-pty';\nimport { isUndefined } from 'lodash';\n\nexport const xterm: IPtyForkOptions = {\n  name: 'xterm-256color',\n  cols: 80,\n  rows: 30,\n  cwd: process.cwd(),\n  env: Object.assign(\n    {},\n    ...Object.keys(process.env)\n      .filter((key: string) => !isUndefined(process.env[key]))\n      .map((key: string) => ({ [key]: process.env[key] }))\n  ),\n};\n","module.exports = require(\"compression\");","module.exports = require(\"crypto\");","module.exports = require(\"express\");","module.exports = require(\"express-winston\");","module.exports = require(\"fs\");","module.exports = require(\"fs-extra\");","module.exports = require(\"helmet\");","module.exports = require(\"http\");","module.exports = require(\"https\");","module.exports = require(\"lodash/isUndefined\");","module.exports = require(\"node-pty\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"serve-favicon\");","module.exports = require(\"socket.io\");","module.exports = require(\"url\");","module.exports = require(\"winston\");","module.exports = require(\"yargs\");"],"sourceRoot":""}